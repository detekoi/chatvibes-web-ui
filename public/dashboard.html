<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatVibes Dashboard</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible+Next:ital,wght@0,200..800;1,200..800&family=Cabin+Condensed:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Custom overrides -->
    <link rel="stylesheet" href="css/custom.css">

    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==">

    <!-- Apply theme early to prevent flash -->
    <script>
        (function() {
            const theme = localStorage.getItem('chatvibes-theme') ||
                         (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            if (theme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>

    <script src="https://app.rybbit.io/api/script.js" data-site-id="780" defer></script>
</head>
<body>

    <div class="container my-4">
        <div class="d-flex align-items-center justify-content-between mb-3">
            <h1 class="h3 mb-0">ChatVibes Dashboard</h1>
            <div class="d-flex align-items-center gap-3">
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" id="darkModeToggle">
                    <label class="form-check-label" for="darkModeToggle">Dark Mode</label>
                </div>
                <a href="viewer-settings.html" class="btn btn-outline-primary btn-sm">Viewer Settings</a>
                <a href="#" id="logout-link" class="btn btn-outline-danger btn-sm">Logout</a>
            </div>
        </div>
        <p class="text-center mb-3">
            <a href="https://detekoi.github.io/chatvibesdocs.html" target="_blank" class="link-primary">Documentation</a>
        </p>

        <div id="auth-status" class="alert alert-info text-center" role="status" style="display: none;"></div>

        <div class="row g-4" id="dashboard-content" style="display: none;">
            <!-- Main column -->
            <div class="col-12 col-md-8">
                <!-- Tabs -->
                <ul class="nav nav-tabs mb-3" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-broadcaster" type="button" role="tab">Broadcaster</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-viewer-defaults" type="button" role="tab">Voice Defaults</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-integrations" type="button" role="tab">OBS Setup</button>
                    </li>
                </ul>

                <div class="tab-content">
                    <!-- Broadcaster Tab -->
                    <div class="tab-pane fade show active" id="tab-broadcaster" role="tabpanel">
                        <!-- Bot Status & Control -->
                        <div class="card mb-4 shadow">
                            <div class="card-body">
                                <p class="mb-1">Welcome, <span id="twitch-username">loading...</span>!</p>
                                <p class="mb-3">Bot status for channel <strong id="channel-name-status">your channel</strong>: <strong id="bot-status">Loading...</strong></p>
                                <div class="d-flex gap-2">
                                    <button id="add-bot-btn" class="btn btn-outline-primary" style="display:none;" type="button">Add Bot to My Channel</button>
                                    <button id="remove-bot-btn" class="btn btn-outline-danger" style="display:none;" type="button">Remove Bot from My Channel</button>
                                </div>
                            </div>
                        </div>

                        <!-- Engine & Mode -->
                        <div class="settings-section">
                            <h5 class="settings-section-title">Engine &amp; Mode</h5>
                            <p class="settings-section-description">Configure TTS engine settings and who can use it</p>
                            <div class="list-group mb-4 shadow">
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <strong class="mb-0">TTS Engine Enabled</strong>
                                            <p class="text-muted mb-0">Enable or disable the text-to-speech engine</p>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="tts-enabled">
                                                <span class="form-check-label"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <strong class="mb-0">Announce Events</strong>
                                            <p class="text-muted mb-0">Announce events like subs, raids, etc.</p>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="events-enabled">
                                                <span class="form-check-label"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <label for="tts-mode" class="form-label mb-1"><strong>TTS Mode</strong></label>
                                            <p class="text-muted mb-0">Choose which messages trigger TTS</p>
                                        </div>
                                        <div class="col-auto">
                                            <select id="tts-mode" class="form-select">
                                                <option value="all">All Messages</option>
                                                <option value="command">!tts Command Only</option>
                                                <option value="bits_points_only">Bits/Points Only</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <label for="tts-permission" class="form-label mb-1"><strong>TTS Permission</strong></label>
                                            <p class="text-muted mb-0">Who can use text-to-speech</p>
                                        </div>
                                        <div class="col-auto">
                                            <select id="tts-permission" class="form-select">
                                                <option value="everyone">Everyone</option>
                                                <option value="mods">Moderators Only</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <strong class="mb-0">Allow Viewer Voice Preferences</strong>
                                            <p class="text-muted mb-0">If off, the channel default voice is used for all messages</p>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="allow-viewer-preferences">
                                                <span class="form-check-label"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <strong class="mb-0">Read Full URLs</strong>
                                            <p class="text-muted mb-0">If on, reads full URLs as-is. If off, only reads domain names for better listening</p>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="read-full-urls">
                                                <span class="form-check-label"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Bits -> TTS -->
                        <div class="settings-section">
                            <h5 class="settings-section-title">Bits → TTS</h5>
                            <p class="settings-section-description">Configure bits requirements for text-to-speech</p>
                            <div class="list-group mb-4 shadow">
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <strong class="mb-0">Require Bits for TTS</strong>
                                            <p class="text-muted mb-0">Users must spend bits to use text-to-speech</p>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="bits-enabled">
                                                <span class="form-check-label"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <label for="bits-amount" class="form-label mb-1"><strong>Minimum Bits Required</strong></label>
                                            <p class="text-muted mb-0">How many bits users must spend for TTS</p>
                                        </div>
                                        <div class="col-auto">
                                            <input type="number" id="bits-amount" class="form-control" min="0" value="100" style="width: 120px;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Channel Points -> TTS -->
                        <div class="settings-section">
                            <h5 class="settings-section-title">Channel Points → TTS</h5>
                            <p class="settings-section-description">Configure channel points rewards for text-to-speech</p>
                            <div class="list-group mb-4 shadow">
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <strong class="mb-0">Enable Channel Points TTS</strong>
                                            <p class="text-muted mb-0">Allow viewers to use channel points for TTS</p>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="cp-enabled">
                                                <span class="form-check-label"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="card mb-4 shadow">
                                <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-12 col-md-6">
                                        <label class="form-label" for="cp-title">Reward title</label>
                                        <input id="cp-title" class="form-control" placeholder="Text-to-Speech Message">
                                        <div class="form-text">Must be unique in your channel.</div>
                                    </div>
                                    <div class="col-12 col-md-6">
                                        <label class="form-label" for="cp-cost">Cost (points)</label>
                                        <input id="cp-cost" type="number" min="1" class="form-control" placeholder="500">
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label" for="cp-prompt">Viewer prompt</label>
                                        <input id="cp-prompt" class="form-control" placeholder="Enter a message to be read aloud">
                                    </div>
                                    <div class="col-12">
                                        <div class="form-check">
                                            <input id="cp-skip-queue" type="checkbox" class="form-check-input">
                                            <label for="cp-skip-queue" class="form-check-label">Skip the Reward Queue</label>
                                        </div>
                                    </div>
                                </div>

                                <details class="mt-3">
                                    <summary class="fw-semibold">Cooldowns and Moderation</summary>
                                    <div class="row g-3 mt-2">
                                        <div class="col-12 d-flex align-items-center" style="gap:8px;">
                                            <input id="cp-limits-enabled" type="checkbox" class="form-check-input">
                                            <label for="cp-limits-enabled" class="form-check-label">Enable Cooldowns &amp; Limits</label>
                                        </div>
                                        <div class="col-12 col-md-4">
                                            <label class="form-label" for="cp-cooldown">Global cooldown (sec)</label>
                                            <input id="cp-cooldown" type="number" min="0" max="3600" class="form-control" placeholder="0">
                                        </div>
                                        <div class="col-12 col-md-4">
                                            <label class="form-label" for="cp-per-stream">Per-stream limit</label>
                                            <input id="cp-per-stream" type="number" min="1" max="1000" class="form-control" placeholder="Enter amount">
                                        </div>
                                        <div class="col-12 col-md-4">
                                            <label class="form-label" for="cp-per-user">Per-user per stream</label>
                                            <input id="cp-per-user" type="number" min="1" max="1000" class="form-control" placeholder="Enter amount">
                                        </div>
                                        <div class="col-12 col-md-4 d-flex align-items-center" style="gap:8px;">
                                            <input id="cp-block-links" type="checkbox" class="form-check-input me-2" checked>
                                            <label for="cp-block-links" class="form-check-label">Block links</label>
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label" for="cp-banned-words">Banned words (comma-separated)</label>
                                            <input id="cp-banned-words" class="form-control" placeholder="">
                                        </div>
                                    </div>
                                </details>

                                <div class="mt-3">
                                    <div class="d-flex flex-wrap gap-2 mb-2">
                                        <button id="cp-save" class="btn btn-primary" type="button">Save</button>
                                        <button id="cp-test" class="btn btn-outline-secondary" type="button">Test redeem</button>
                                        <button id="cp-delete" class="btn btn-outline-danger" type="button">Disable &amp; Delete</button>
                                    </div>
                                    <div class="small text-muted">
                                        <span id="cp-status-line"></span>
                                    </div>
                                </div>
                                <p id="cp-msg" class="small mt-2 mb-0"></p>
                            </div>
                        </div>
                        </div>

                        <!-- Music Generation -->
                        <div class="settings-section">
                            <h5 class="settings-section-title">Music Generation</h5>
                            <p class="settings-section-description">Configure music bot settings and permissions</p>
                            <div class="list-group mb-4 shadow">
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <strong class="mb-0">Music Generation Enabled</strong>
                                            <p class="text-muted mb-0">Enable or disable the music generation feature</p>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="music-enabled">
                                                <span class="form-check-label"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <strong class="mb-0">Require Bits for Music</strong>
                                            <p class="text-muted mb-0">Users must spend bits to generate music</p>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="music-bits-enabled">
                                                <span class="form-check-label"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <label for="music-mode" class="form-label mb-1"><strong>Who Can Generate Music</strong></label>
                                            <p class="text-muted mb-0">Permission level for music commands</p>
                                        </div>
                                        <div class="col-auto">
                                            <select id="music-mode" class="form-select">
                                                <option value="everyone">Everyone</option>
                                                <option value="moderator">Moderators Only</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <label for="music-bits-amount" class="form-label mb-1"><strong>Minimum Bits for Music</strong></label>
                                            <p class="text-muted mb-0">How many bits users must spend for music</p>
                                        </div>
                                        <div class="col-auto">
                                            <input type="number" id="music-bits-amount" class="form-control" min="0" value="100" style="width: 120px;">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Ignored Users -->
                        <div class="settings-section">
                            <h5 class="settings-section-title">Ignored Users</h5>
                            <p class="settings-section-description">Manage users who are ignored by TTS and music commands</p>

                            <div class="mb-4">
                                <h6 class="mb-2"><strong>TTS Ignore List</strong></h6>
                                <p class="text-muted small mb-2">Users on this list will not have their messages read by TTS</p>
                                <div class="card shadow">
                                    <div class="card-body">
                                        <div class="input-group mb-2">
                                            <input type="text" id="tts-ignore-username" class="form-control" placeholder="Username to ignore">
                                            <button id="add-tts-ignore-btn" class="btn btn-secondary" type="button">Add</button>
                                        </div>
                                        <ul id="tts-ignore-list" class="ignore-list list-group"></ul>
                                    </div>
                                </div>
                            </div>

                            <div class="mb-4">
                                <h6 class="mb-2"><strong>Music Ignore List</strong></h6>
                                <p class="text-muted small mb-2">Users on this list cannot use music bot commands</p>
                                <div class="card shadow">
                                    <div class="card-body">
                                        <div class="input-group mb-2">
                                            <input type="text" id="music-ignore-username" class="form-control" placeholder="Username to ignore">
                                            <button id="add-music-ignore-btn" class="btn btn-secondary" type="button">Add</button>
                                        </div>
                                        <ul id="music-ignore-list" class="ignore-list list-group"></ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-grid">
                            <button id="save-settings-btn" class="btn btn-primary" type="button">Save All Settings</button>
                        </div>
                    </div>

                    <!-- Voice Defaults Tab -->
                    <div class="tab-pane fade" id="tab-viewer-defaults" role="tabpanel">
                        <div class="settings-section">
                            <h5 class="settings-section-title">Default Voice Settings</h5>
                            <p class="settings-section-description">Define default voice parameters for your channel</p>
                            <div class="list-group mb-4 shadow">
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <label for="default-voice" class="form-label mb-1"><strong>Default Voice</strong></label>
                                            <p class="text-muted mb-0">Select the default TTS voice for the channel</p>
                                        </div>
                                        <div class="col-auto d-flex align-items-center" style="gap:8px;">
                                            <div class="custom-voice-dropdown" id="default-voice-dropdown">
                                                <input type="text" id="default-voice-search" class="form-control" placeholder="Search voices..." readonly>
                                                <input type="hidden" id="default-voice" value="Friendly_Person">
                                                <div class="voice-dropdown-menu" id="default-voice-menu">
                                                    <div class="voice-dropdown-list"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <label for="default-emotion" class="form-label mb-1"><strong>Default Emotion</strong></label>
                                            <p class="text-muted mb-0">Set the emotional tone of the default voice</p>
                                        </div>
                                        <div class="col-auto d-flex align-items-center" style="gap:8px;">
                                            <select id="default-emotion" class="form-select">
                                                <option value="neutral">Neutral</option>
                                                <option value="happy">Happy</option>
                                                <option value="sad">Sad</option>
                                                <option value="angry">Angry</option>
                                                <option value="fearful">Fearful</option>
                                                <option value="disgusted">Disgusted</option>
                                                <option value="surprised">Surprised</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <label for="default-pitch" class="form-label mb-1"><strong>Default Pitch (-12 to +12): <span id="pitch-value">0</span></strong></label>
                                            <p class="text-muted mb-0">Adjust overall pitch for the default voice</p>
                                        </div>
                                        <div class="col-auto d-flex align-items-center" style="gap:8px; min-width: 260px;">
                                            <input type="range" id="default-pitch" class="form-range" min="-12" max="12" value="0">
                                            <button id="reset-pitch-btn" class="btn btn-outline-secondary btn-sm" type="button">Reset</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <label for="default-speed" class="form-label mb-1"><strong>Default Speed (0.5 to 2.0): <span id="speed-value">1.0</span></strong></label>
                                            <p class="text-muted mb-0">Control how fast the default voice speaks</p>
                                        </div>
                                        <div class="col-auto d-flex align-items-center" style="gap:8px; min-width: 260px;">
                                            <input type="range" id="default-speed" class="form-range" min="0.5" max="2.0" step="0.1" value="1.0">
                                            <button id="reset-speed-btn" class="btn btn-outline-secondary btn-sm" type="button">Reset</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <label for="default-language" class="form-label mb-1"><strong>Default Language</strong></label>
                                            <p class="text-muted mb-0">Improve pronunciation for specific languages</p>
                                        </div>
                                        <div class="col-auto d-flex align-items-center" style="gap:8px;">
                                            <select id="default-language" class="form-select">
                                                <option value="auto">Automatic</option>
                                                <option value="Chinese">Chinese</option>
                                                <option value="Chinese,Yue">Chinese, Yue (Cantonese)</option>
                                                <option value="English">English</option>
                                                <option value="Arabic">Arabic</option>
                                                <option value="Russian">Russian</option>
                                                <option value="Spanish">Spanish</option>
                                                <option value="French">French</option>
                                                <option value="Portuguese">Portuguese</option>
                                                <option value="German">German</option>
                                                <option value="Turkish">Turkish</option>
                                                <option value="Dutch">Dutch</option>
                                                <option value="Ukrainian">Ukrainian</option>
                                                <option value="Vietnamese">Vietnamese</option>
                                                <option value="Indonesian">Indonesian</option>
                                                <option value="Japanese">Japanese</option>
                                                <option value="Italian">Italian</option>
                                                <option value="Korean">Korean</option>
                                                <option value="Thai">Thai</option>
                                                <option value="Polish">Polish</option>
                                                <option value="Romanian">Romanian</option>
                                                <option value="Greek">Greek</option>
                                                <option value="Czech">Czech</option>
                                                <option value="Finnish">Finnish</option>
                                                <option value="Hindi">Hindi</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="list-group-item">
                                    <div class="row align-items-center">
                                        <div class="col">
                                            <strong class="mb-0">English Normalization</strong>
                                            <p class="text-muted mb-0">Improve number and text pronunciation</p>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input" type="checkbox" id="english-normalization">
                                                <span class="form-check-label"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Voice Preview - Mobile (visible on md and below) -->
                        <div class="d-md-none mb-4">
                            <div class="card">
                                <div class="card-header">Voice Preview</div>
                                <div class="card-body">
                                    <label for="voice-test-text-mobile" class="form-label">Test Message</label>
                                    <textarea id="voice-test-text-mobile" class="form-control mb-2" rows="3" maxlength="500">Welcome, everyone, to the stream!</textarea>
                                    <div class="d-grid">
                                        <button id="voice-test-btn-mobile" class="btn btn-primary" type="button">Send Preview</button>
                                    </div>
                                    <!-- Audio Player Container -->
                                    <div id="voice-preview-player-mobile" class="voice-preview-player mt-3" style="display: none;">
                                        <audio controls class="w-100">
                                            <source id="voice-preview-source-mobile" type="audio/mpeg">
                                            Your browser does not support the audio element.
                                        </audio>
                                        <small id="voice-preview-hint-mobile" class="settings-changed-hint text-warning mt-1" style="display: none;">
                                            <i>⚠ Settings changed - regenerate for updated preview</i>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- OBS Setup Tab -->
                    <div class="tab-pane fade" id="tab-integrations" role="tabpanel">
                        <div class="card mb-4 shadow">
                            <div class="card-header">ChatVibes OBS Setup</div>
                            <div class="card-body">
                                <p class="mb-3">To hear ChatVibes TTS alerts in your stream and for yourself, add it as a Browser Source in OBS (or Streamlabs, etc.) and configure audio monitoring. The URL below is a secure Browser Source URL with authentication tokens. For usage instructions, visit the <a href="https://docs.wildcat.chat/chatvibesdocs.html" target="_blank">documentation page</a>.</p>

                                <div class="row g-2 align-items-center tts-url-container mb-1">
                                    <div class="col-12 col-md-9">
                                        <input type="text" id="tts-url-field" class="form-control" readonly placeholder="Your TTS URL will appear here...">
                                    </div>
                                    <div class="col-12 col-md-3 d-grid">
                                        <button id="copy-tts-url-btn" class="btn btn-outline-primary" type="button">Copy URL</button>
                                    </div>
                                </div>
                                <p class="mb-3"><a href="#" id="regenerate-tts-url-btn" class="link-secondary">Regenerate URL</a></p>

                                <h6>Step 1: Add Browser Source</h6>
                                <ol>
                                    <li>In OBS, under 'Sources', click the '+' button.</li>
                                    <li>Select 'Browser'.</li>
                                    <li>Give it a name (e.g., "ChatVibes TTS").</li>
                                    <li>In the properties window:
                                        <ul>
                                            <li><strong>URL:</strong> Paste the URL copied from above.</li>
                                            <li><strong>Width &amp; Height:</strong> You can safely ignore these settings, or set them to something small (e.g., 300x100), as this source is for audio only.</li>
                                            <li>Ensure "Control audio via OBS" is CHECKED.</li>
                                            <li>For persistent audio, it's recommended to UNCHECK "Shutdown source when not visible" and "Refresh browser when scene becomes active".</li>
                                        </ul>
                                    </li>
                                    <li>Click 'OK'.</li>
                                </ol>

                                <h6 class="mt-3">Step 2: Enable Audio Monitoring</h6>
                                <ol>
                                    <li>In OBS, find your audio mixer (usually at the bottom).</li>
                                    <li>Locate the audio source for "ChatVibes TTS" (or whatever you named it).</li>
                                    <li>Click the gear icon (⚙️) next to its volume bar and select 'Advanced Audio Properties'.</li>
                                    <li>In the Advanced Audio Properties window, find your "ChatVibes TTS" source.</li>
                                    <li>Under 'Audio Monitoring', select:
                                        <ul>
                                            <li><strong>"Monitor and Output"</strong> if you want to hear the TTS alerts yourself AND have your stream hear them.</li>
                                            <li><strong>"Monitor Only (mute output)"</strong> if you only want to hear them yourself.</li>
                                        </ul>
                                    </li>
                                    <li>Close the Advanced Audio Properties window.</li>
                                </ol>
                                <p class="fw-semibold">Important: Make sure the ChatVibes TTS browser source is unmuted in your OBS audio mixer and the volume is at an appropriate level.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar column -->
            <div class="col-12 col-md-4 d-none d-md-block">
                <div class="card sticky-top sticky-aside mb-4">
                    <div class="card-header">Voice Preview</div>
                    <div class="card-body">
                        <label for="voice-test-text" class="form-label">Test Message</label>
                        <textarea id="voice-test-text" class="form-control mb-2" rows="3" maxlength="500">Welcome, everyone, to the stream!</textarea>
                        <div class="d-grid">
                            <button id="voice-test-btn" class="btn btn-primary" type="button">Send Preview</button>
                        </div>
                        <!-- Audio Player Container -->
                        <div id="voice-preview-player" class="voice-preview-player mt-3" style="display: none;">
                            <audio controls class="w-100">
                                <source id="voice-preview-source" type="audio/mpeg">
                                Your browser does not support the audio element.
                            </audio>
                            <small id="voice-preview-hint" class="settings-changed-hint text-warning mt-1" style="display: none;">
                                <i>⚠ Settings changed - regenerate for updated preview</i>
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toasts -->
    <div id="toast-container" class="toast-container position-fixed bottom-0 end-0 p-3"></div>

    <!-- Bootstrap 5 Bundle JS (with Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!-- Theme Management -->
    <script src="js/theme.js"></script>

    <script type="module" src="js/dashboard/main.js"></script>
</body>
</html>
