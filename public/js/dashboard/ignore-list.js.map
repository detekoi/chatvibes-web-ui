{
  "version": 3,
  "sources": ["ignore-list.ts"],
  "sourcesContent": ["import { showToast } from '../common/ui.js';\n\n/**\n * Ignore list type\n */\nexport type IgnoreListType = 'tts' | 'music';\n\n/**\n * Ignore list module context\n */\ninterface IgnoreListContext {\n  botApiBaseUrl: string;\n  testMode: boolean;\n}\n\n/**\n * Ignore list module services\n */\ninterface IgnoreListServices {\n  getLoggedInUser: () => { login: string; id: string; displayName: string } | null;\n  getSessionToken: () => string | null;\n}\n\n/**\n * Ignore list module return type\n */\nexport interface IgnoreListModule {\n  displayIgnoreList: (type: IgnoreListType, users: string[]) => void;\n  setOnChange: (fn: () => void) => void;\n}\n\n/**\n * Ignore list API error response\n */\ninterface IgnoreListErrorResponse {\n  error?: string;\n}\n\n/**\n * Manage TTS and music ignore lists.\n */\nexport function initIgnoreListModule(\n  context: IgnoreListContext,\n  services: IgnoreListServices\n): IgnoreListModule {\n  const { botApiBaseUrl, testMode } = context;\n  const { getLoggedInUser, getSessionToken } = services;\n  let onChangeCallback: (() => void) | null = null;\n\n  const addTtsIgnoreBtn = document.getElementById('add-tts-ignore-btn');\n  const addMusicIgnoreBtn = document.getElementById('add-music-ignore-btn');\n\n  function authHeaders(): HeadersInit {\n    const headers: HeadersInit = { 'Content-Type': 'application/json' };\n    const token = getSessionToken();\n    if (token) headers['Authorization'] = `Bearer ${token}`;\n    return headers;\n  }\n\n  function displayIgnoreList(type: IgnoreListType, users: string[]): void {\n    const listEl = document.getElementById(`${type}-ignore-list`);\n    if (!listEl) return;\n\n    listEl.innerHTML = '';\n    if (!users || users.length === 0) {\n      const li = document.createElement('li');\n      li.className = 'list-group-item';\n      li.innerHTML = '<span class=\"text-muted fst-italic\">No ignored users</span>';\n      listEl.appendChild(li);\n      return;\n    }\n\n    users.forEach(username => {\n      const li = document.createElement('li');\n      li.className = 'list-group-item d-flex justify-content-between align-items-center';\n\n      const nameSpan = document.createElement('span');\n      nameSpan.textContent = username;\n\n      const btn = document.createElement('button');\n      btn.className = 'btn btn-outline-danger btn-sm';\n      btn.type = 'button';\n      btn.textContent = 'Remove';\n      btn.addEventListener('click', () => removeFromIgnoreList(type, username));\n\n      li.appendChild(nameSpan);\n      li.appendChild(btn);\n      listEl.appendChild(li);\n    });\n  }\n\n  async function addToIgnoreList(type: IgnoreListType): Promise<void> {\n    const inputEl = document.getElementById(`${type}-ignore-username`) as HTMLInputElement | null;\n    const username = inputEl?.value?.trim();\n    if (!username) {\n      showToast('Please enter a username', 'warning');\n      return;\n    }\n\n    if (testMode) {\n      const listEl = document.getElementById(`${type}-ignore-list`);\n      if (listEl) {\n        const current = Array.from(listEl.querySelectorAll('li span')).map(s => s.textContent || '');\n        current.push(username);\n        displayIgnoreList(type, current);\n      }\n      inputEl.value = '';\n      onChangeCallback?.();\n      return;\n    }\n\n    const user = getLoggedInUser();\n    if (!user?.login) {\n      showToast('Not logged in', 'error');\n      return;\n    }\n\n    try {\n      const channelName = user.login.toLowerCase();\n      const response = await fetch(`${botApiBaseUrl}/${type}/ignore/channel/${channelName}`, {\n        method: 'POST',\n        headers: authHeaders(),\n        body: JSON.stringify({ username })\n      });\n      if (response.ok) {\n        inputEl.value = '';\n        onChangeCallback?.();\n      } else if (response.status === 500 || response.status === 404) {\n        showToast('Settings management is not available yet. The bot needs the latest REST API endpoints.', 'warning');\n      } else {\n        const errorData = await response.json().catch(() => ({ error: 'Unknown error' })) as IgnoreListErrorResponse;\n        showToast(`Failed to add user: ${errorData.error}`, 'error');\n      }\n    } catch (error) {\n      console.error(`Failed to add user to ${type} ignore list:`, error);\n      showToast('Failed to add user to ignore list', 'error');\n    }\n  }\n\n  async function removeFromIgnoreList(type: IgnoreListType, username: string): Promise<void> {\n    if (testMode) {\n      const listEl = document.getElementById(`${type}-ignore-list`);\n      if (listEl) {\n        const remaining = Array.from(listEl.querySelectorAll('li span'))\n          .map(s => s.textContent || '')\n          .filter(u => u !== username);\n        displayIgnoreList(type, remaining);\n      }\n      onChangeCallback?.();\n      return;\n    }\n\n    const user = getLoggedInUser();\n    if (!user?.login) {\n      showToast('Not logged in', 'error');\n      return;\n    }\n\n    try {\n      const channelName = user.login.toLowerCase();\n      const response = await fetch(`${botApiBaseUrl}/${type}/ignore/channel/${channelName}`, {\n        method: 'DELETE',\n        headers: authHeaders(),\n        body: JSON.stringify({ username })\n      });\n      if (response.ok) {\n        onChangeCallback?.();\n      } else if (response.status === 500 || response.status === 404) {\n        showToast('Settings management is not available yet. The bot needs the latest REST API endpoints.', 'warning');\n      } else {\n        const errorData = await response.json().catch(() => ({ error: 'Unknown error' })) as IgnoreListErrorResponse;\n        showToast(`Failed to remove user: ${errorData.error}`, 'error');\n      }\n    } catch (error) {\n      console.error(`Failed to remove user from ${type} ignore list:`, error);\n      showToast('Failed to remove user from ignore list', 'error');\n    }\n  }\n\n  if (addTtsIgnoreBtn) {\n    addTtsIgnoreBtn.addEventListener('click', () => addToIgnoreList('tts'));\n  }\n  if (addMusicIgnoreBtn) {\n    addMusicIgnoreBtn.addEventListener('click', () => addToIgnoreList('music'));\n  }\n\n  return {\n    displayIgnoreList,\n    setOnChange(fn: () => void): void {\n      onChangeCallback = typeof fn === 'function' ? fn : null;\n    },\n  };\n}\n"],
  "mappings": "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",
  "names": []
}
