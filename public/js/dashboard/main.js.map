{
  "version": 3,
  "sources": ["main.ts"],
  "sourcesContent": ["import { getApiBaseUrl } from '../common/api.js';\nimport { getStoredSessionToken, getStoredUser, logout, StoredUser } from '../common/auth.js';\nimport { showToast } from '../common/ui.js';\nimport { initBotManagement, BotManagementModule } from './bot-management.js';\nimport { initObsModule, ObsModule } from './obs.js';\nimport { initSettingsModule } from './settings.js';\nimport { initChannelPointsModule, ChannelPointsModule } from './channel-points.js';\nimport { initIgnoreListModule, IgnoreListModule } from './ignore-list.js';\n\n/**\n * Dashboard application state\n */\ninterface DashboardState {\n  sessionToken: string | null;\n  loggedInUser: StoredUser | null;\n}\n\n/**\n * Services provided to dashboard modules\n */\ninterface DashboardServices {\n  getSessionToken: () => string | null;\n  getLoggedInUser: () => StoredUser | null;\n}\n\n/**\n * Settings module interface\n */\ninterface SettingsModule {\n  initialize: () => Promise<void>;\n  loadSettings: () => Promise<void>;\n}\n\n/**\n * JWT token payload\n */\ninterface JwtPayload {\n  scope?: string;\n  [key: string]: unknown;\n}\n\n/**\n * Auth initiate API response\n */\ninterface AuthInitiateResponse {\n  success: boolean;\n  twitchAuthUrl?: string;\n  state?: string;\n  error?: string;\n}\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const testMode = new URLSearchParams(window.location.search).has('test');\n  const authStatus = document.getElementById('auth-status') as HTMLDivElement | null;\n  const dashboardContent = document.getElementById('dashboard-content') as HTMLDivElement | null;\n  const twitchUsernameEl = document.getElementById('twitch-username') as HTMLElement | null;\n  const channelNameStatusEl = document.getElementById('channel-name-status') as HTMLElement | null;\n  const botStatusEl = document.getElementById('bot-status') as HTMLElement | null;\n  const addBotBtn = document.getElementById('add-bot-btn') as HTMLButtonElement | null;\n  const removeBotBtn = document.getElementById('remove-bot-btn') as HTMLButtonElement | null;\n  const logoutLink = document.getElementById('logout-link') as HTMLAnchorElement | null;\n  const ttsUrlField = document.getElementById('tts-url-field') as HTMLInputElement | null;\n  const copyTtsUrlBtn = document.getElementById('copy-tts-url-btn') as HTMLButtonElement | null;\n  const regenerateTtsUrlBtn = document.getElementById('regenerate-tts-url-btn') as HTMLButtonElement | null;\n\n  const apiBaseUrl = getApiBaseUrl();\n  const botApiBaseUrl = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'\n    ? 'http://localhost:8080/api'\n    : 'https://chatvibes-tts-service-h7kj56ct4q-uc.a.run.app/api';\n\n  const state: DashboardState = {\n    sessionToken: getStoredSessionToken(),\n    loggedInUser: getStoredUser(),\n  };\n\n  const services: DashboardServices = {\n    getSessionToken: () => state.sessionToken,\n    getLoggedInUser: () => state.loggedInUser,\n  };\n\n  const ignoreModule: IgnoreListModule = initIgnoreListModule({ botApiBaseUrl, testMode }, services);\n  const settingsModule: SettingsModule = initSettingsModule({ botApiBaseUrl, testMode }, services, {\n    displayIgnoreList: ignoreModule.displayIgnoreList,\n  });\n  ignoreModule.setOnChange(() => settingsModule.loadSettings());\n\n  const botModule: BotManagementModule = initBotManagement({ botStatusEl, addBotBtn, removeBotBtn }, { apiBaseUrl, testMode }, services);\n  const obsModule: ObsModule = initObsModule({ ttsUrlField, copyTtsUrlBtn, regenerateTtsUrlBtn }, { apiBaseUrl, testMode }, services);\n  const channelPointsModule: ChannelPointsModule = initChannelPointsModule({ apiBaseUrl, testMode }, services, {\n    onSettingsRefresh: () => settingsModule.loadSettings(),\n  });\n\n  if (logoutLink) {\n    logoutLink.addEventListener('click', (e: Event) => {\n      e.preventDefault();\n      logout();\n    });\n  }\n\n  initializeDashboard();\n\n  async function initializeDashboard(): Promise<void> {\n    if (state.sessionToken && isViewerToken(state.sessionToken)) {\n      showViewerTokenMessage();\n      return;\n    }\n\n    if (testMode) {\n      state.sessionToken = 'TEST_SESSION_TOKEN';\n      state.loggedInUser = { login: 'demostreamer', id: '123456', displayName: 'Demo Streamer' };\n      showDashboard();\n      await obsModule.loadExistingTtsUrl(state.loggedInUser.login);\n      botModule.updateBotStatusUI(false);\n      await settingsModule.initialize();\n      await channelPointsModule.load();\n      return;\n    }\n\n    if (state.loggedInUser?.login) {\n      showDashboard();\n      if (!state.sessionToken) {\n        showToast('Authentication token missing. Please log in again.', 'error');\n        return;\n      }\n      await Promise.all([\n        obsModule.loadExistingTtsUrl(state.loggedInUser.login),\n        botModule.refreshStatus(),\n        settingsModule.initialize(),\n        channelPointsModule.load(),\n      ]);\n    } else {\n      showLoginPrompt();\n    }\n  }\n\n  function isViewerToken(token: string): boolean {\n    try {\n      const payload = JSON.parse(atob(token.split('.')[1])) as JwtPayload;\n      return payload.scope === 'viewer';\n    } catch (error) {\n      console.error('Error decoding token:', error);\n      return false;\n    }\n  }\n\n  function showDashboard(): void {\n    if (authStatus) {\n      authStatus.innerHTML = '';\n      authStatus.className = '';\n      authStatus.style.display = 'none';\n    }\n    if (dashboardContent) dashboardContent.style.display = 'flex';\n    if (twitchUsernameEl) twitchUsernameEl.textContent = state.loggedInUser?.displayName || state.loggedInUser?.login || 'loading\u2026';\n    if (channelNameStatusEl) channelNameStatusEl.textContent = state.loggedInUser?.login || '';\n  }\n\n  function showViewerTokenMessage(): void {\n    if (dashboardContent) dashboardContent.style.display = 'none';\n    if (authStatus) {\n      authStatus.innerHTML = '';\n      authStatus.className = 'alert alert-info text-center';\n      authStatus.style.display = 'block';\n\n      const message = document.createElement('p');\n      message.textContent = 'Please sign in with your broadcaster account to access streamer settings.';\n      authStatus.appendChild(message);\n\n      const loginButton = document.createElement('button');\n      loginButton.textContent = 'Sign in with Twitch';\n      loginButton.className = 'btn btn-primary mt-2';\n      loginButton.onclick = () => redirectToTwitch();\n      authStatus.appendChild(loginButton);\n    }\n  }\n\n  function showLoginPrompt(): void {\n    if (dashboardContent) dashboardContent.style.display = 'none';\n    if (authStatus) {\n      authStatus.innerHTML = '';\n      authStatus.className = 'alert alert-info text-center';\n      authStatus.style.display = 'block';\n\n      const message = document.createElement('p');\n      message.textContent = 'Please verify your Twitch identity to access streamer settings.';\n      authStatus.appendChild(message);\n\n      const loginButton = document.createElement('button');\n      loginButton.textContent = 'Sign in with Twitch';\n      loginButton.className = 'btn btn-primary mt-2';\n      loginButton.onclick = () => redirectToTwitch();\n      authStatus.appendChild(loginButton);\n    }\n  }\n\n  async function redirectToTwitch(): Promise<void> {\n    if (!authStatus) return;\n    authStatus.innerHTML = '<p>Redirecting to Twitch for authentication...</p>';\n    try {\n      const response = await fetch(`${apiBaseUrl}/auth/twitch/initiate`);\n      if (!response.ok) {\n        throw new Error(`Failed to initiate auth: ${response.statusText}`);\n      }\n      const data = await response.json() as AuthInitiateResponse;\n      if (data.success && data.twitchAuthUrl && data.state) {\n        sessionStorage.setItem('oauth_csrf_state', data.state);\n        window.location.href = data.twitchAuthUrl;\n      } else {\n        throw new Error(data.error || 'Could not initiate login with Twitch');\n      }\n    } catch (error) {\n      console.error('Error during login initiation:', error);\n      authStatus.innerHTML = '<p class=\"text-danger\">Failed to start authentication. Please try again.</p>';\n    }\n  }\n});\n"],
  "mappings": "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",
  "names": []
}
