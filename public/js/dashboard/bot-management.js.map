{
  "version": 3,
  "sources": ["bot-management.ts"],
  "sourcesContent": ["import { fetchWithAuth } from '../common/api.js';\nimport { showToast } from '../common/ui.js';\n\n/**\n * Bot management module parameters\n */\ninterface BotManagementElements {\n  botStatusEl: HTMLElement | null;\n  addBotBtn: HTMLButtonElement | null;\n  removeBotBtn: HTMLButtonElement | null;\n}\n\n/**\n * Bot management context\n */\ninterface BotManagementContext {\n  apiBaseUrl: string;\n  testMode: boolean;\n}\n\n/**\n * Bot management services\n */\ninterface BotManagementServices {\n  getSessionToken: () => string | null;\n}\n\n/**\n * Bot status API response\n */\ninterface BotStatusResponse {\n  success: boolean;\n  isActive: boolean;\n  message?: string;\n}\n\n/**\n * Bot add/remove API response\n */\ninterface BotActionResponse {\n  success: boolean;\n  message?: string;\n  code?: string;\n  details?: string;\n}\n\n/**\n * Bot management module return type\n */\nexport interface BotManagementModule {\n  refreshStatus: () => Promise<void>;\n  updateBotStatusUI: (isActive: boolean) => void;\n}\n\n/**\n * Bot management card bindings.\n */\nexport function initBotManagement(\n  { botStatusEl, addBotBtn, removeBotBtn }: BotManagementElements,\n  context: BotManagementContext,\n  services: BotManagementServices\n): BotManagementModule {\n  const { apiBaseUrl, testMode } = context;\n  const { getSessionToken } = services;\n\n  function updateBotStatusUI(isActive: boolean): void {\n    if (isActive) {\n      if (botStatusEl) {\n        botStatusEl.textContent = 'Active';\n        botStatusEl.className = 'fw-semibold text-success';\n      }\n      if (addBotBtn) addBotBtn.style.display = 'none';\n      if (removeBotBtn) removeBotBtn.style.display = 'inline-block';\n    } else {\n      if (botStatusEl) {\n        botStatusEl.textContent = 'Inactive / Not Joined';\n        botStatusEl.className = 'fw-semibold text-secondary';\n      }\n      if (addBotBtn) addBotBtn.style.display = 'inline-block';\n      if (removeBotBtn) removeBotBtn.style.display = 'none';\n    }\n  }\n\n  async function refreshStatus(): Promise<void> {\n    if (testMode) {\n      updateBotStatusUI(false);\n      return;\n    }\n\n    if (!getSessionToken()) {\n      if (botStatusEl) botStatusEl.textContent = 'Not authenticated';\n      return;\n    }\n\n    try {\n      const statusRes = await fetchWithAuth(`${apiBaseUrl}/api/bot/status`, { method: 'GET' });\n      const statusData = await statusRes.json() as BotStatusResponse;\n      if (statusData.success) {\n        updateBotStatusUI(statusData.isActive);\n      } else {\n        showToast(`Error: ${statusData.message}`, 'error');\n        if (botStatusEl) botStatusEl.textContent = 'Error';\n      }\n    } catch (error) {\n      console.error('Error fetching bot status:', error);\n      const err = error as Error;\n      showToast(`Failed to load bot status. ${err.message}`, 'error');\n      if (botStatusEl) botStatusEl.textContent = 'Error';\n    }\n  }\n\n  if (addBotBtn) {\n    addBotBtn.addEventListener('click', async () => {\n      if (testMode) {\n        showToast('Bot added to channel! (test mode)', 'success');\n        updateBotStatusUI(true);\n        return;\n      }\n      if (!getSessionToken()) {\n        showToast('Authentication token missing. Please log in again.', 'error');\n        return;\n      }\n      showToast('Requesting bot to join...', 'info');\n      try {\n        const res = await fetchWithAuth(`${apiBaseUrl}/api/bot/add`, { method: 'POST' });\n        const data = await res.json() as BotActionResponse;\n        if (data.success) {\n          showToast(data.message || 'Bot added to channel!', 'success');\n          updateBotStatusUI(true);\n        } else if (data.code === 'not_allowed') {\n          const errorText = data.details || data.message || 'Channel not authorized.';\n          const html = errorText.includes('https://detekoi.github.io/#contact-me')\n            ? errorText.replace('https://detekoi.github.io/#contact-me', '<a href=\"https://detekoi.github.io/#contact-me\" target=\"_blank\" class=\"link-light\">this link</a>')\n            : `${errorText} <a href=\"https://detekoi.github.io/#contact-me\" target=\"_blank\" class=\"link-light\">Request access here</a>.`;\n          showToast(html, 'error');\n        } else {\n          showToast(data.message || 'Failed to add bot.', 'error');\n        }\n      } catch (error) {\n        console.error('Error adding bot:', error);\n        showToast('Failed to send request to add bot.', 'error');\n      }\n    });\n  }\n\n  if (removeBotBtn) {\n    removeBotBtn.addEventListener('click', async () => {\n      if (testMode) {\n        showToast('Bot removed from channel. (test mode)', 'success');\n        updateBotStatusUI(false);\n        return;\n      }\n      if (!getSessionToken()) {\n        showToast('Authentication token missing. Please log in again.', 'error');\n        return;\n      }\n      showToast('Requesting bot to leave...', 'info');\n      try {\n        const res = await fetchWithAuth(`${apiBaseUrl}/api/bot/remove`, { method: 'POST' });\n        const data = await res.json() as BotActionResponse;\n        showToast(data.message || 'Request sent.', data.success ? 'success' : 'error');\n        if (data.success) updateBotStatusUI(false);\n      } catch (error) {\n        console.error('Error removing bot:', error);\n        showToast('Failed to send request to remove bot.', 'error');\n      }\n    });\n  }\n\n  return { refreshStatus, updateBotStatusUI };\n}\n"],
  "mappings": "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",
  "names": []
}
