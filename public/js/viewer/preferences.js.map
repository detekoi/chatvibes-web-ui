{
  "version": 3,
  "sources": ["preferences.ts"],
  "sourcesContent": ["import { fetchWithAuth } from '../common/api.js';\nimport { showToast, syncTextareas } from '../common/ui.js';\nimport { formatNumberCompact, formatVoiceName } from '../common/utils.js';\nimport { performVoiceTest, TTSPayload, PlayerElements, HintElements } from '../common/voice-preview.js';\nimport { getLanguageExample } from '../common/language-examples.js';\n\n/**\n * Viewer voice preferences module.\n * Handles voice dropdown, preference controls, and preview playback.\n */\n\n/**\n * Viewer preference values\n */\nexport interface ViewerPreferences {\n  voiceId?: string | null;\n  pitch?: number | null;\n  speed?: number | null;\n  emotion?: string | null;\n  language?: string | null;\n  englishNormalization?: boolean | null;\n}\n\n/**\n * Channel default settings\n */\nexport interface ChannelDefaults {\n  voiceId?: string;\n  pitch?: number;\n  speed?: number;\n  emotion?: string;\n  language?: string;\n  englishNormalization?: boolean;\n}\n\n/**\n * Channel policy settings\n */\nexport interface ChannelPolicy {\n  allowViewerPreferences: boolean;\n}\n\n/**\n * Ignore status for TTS and music\n */\nexport interface IgnoreStatus {\n  tts?: boolean;\n  music?: boolean;\n}\n\n/**\n * Full preferences data structure from API\n */\nexport interface PreferencesData {\n  voiceId?: string | null;\n  pitch?: number | null;\n  speed?: number | null;\n  emotion?: string | null;\n  language?: string | null;\n  englishNormalization?: boolean | null;\n  channelDefaults?: ChannelDefaults;\n  channelPolicy?: ChannelPolicy;\n  ignoreStatus?: IgnoreStatus;\n  [key: string]: string | number | boolean | null | undefined | ChannelDefaults | ChannelPolicy | IgnoreStatus;\n}\n\n/**\n * Information returned from loadPreferences\n */\nexport interface PreferencesInfo {\n  allowViewerPreferences: boolean;\n  ignoreStatus: IgnoreStatus;\n  channelDefaults: ChannelDefaults;\n}\n\n/**\n * DOM elements used by the preferences module\n */\ninterface PreferencesElements {\n  voiceSelect: HTMLSelectElement | null;\n  voiceSearch: HTMLInputElement | null;\n  voiceDropdown: HTMLElement | null;\n  voiceMenu: HTMLElement | null;\n  pitchSlider: HTMLInputElement | null;\n  pitchValue: HTMLElement | null;\n  speedSlider: HTMLInputElement | null;\n  speedValue: HTMLElement | null;\n  emotionSelect: HTMLSelectElement | null;\n  languageSelect: HTMLSelectElement | null;\n  voiceReset: HTMLButtonElement | null;\n  pitchReset: HTMLButtonElement | null;\n  speedReset: HTMLButtonElement | null;\n  emotionReset: HTMLButtonElement | null;\n  languageReset: HTMLButtonElement | null;\n  englishNormalizationCheckbox: HTMLInputElement | null;\n  englishNormalizationReset: HTMLButtonElement | null;\n  hintVoice: HTMLElement | null;\n  hintPitch: HTMLElement | null;\n  hintSpeed: HTMLElement | null;\n  hintEmotion: HTMLElement | null;\n  hintLanguage: HTMLElement | null;\n  hintEnglishNorm: HTMLElement | null;\n  previewText: HTMLTextAreaElement | null;\n  previewBtn: HTMLButtonElement | null;\n  previewTextMobile: HTMLTextAreaElement | null;\n  previewBtnMobile: HTMLButtonElement | null;\n  previewPlayer: HTMLElement | null;\n  previewPlayerMobile: HTMLElement | null;\n  previewSource: HTMLSourceElement | null;\n  previewSourceMobile: HTMLSourceElement | null;\n  previewHint: HTMLElement | null;\n  previewHintMobile: HTMLElement | null;\n  prefsDisabledNote: HTMLElement | null;\n}\n\n/**\n * State tracked by the preferences module\n */\ninterface PreferencesState {\n  availableVoices: string[];\n  currentPreferences: PreferencesData;\n  cachedAudioUrl: string | null;\n  cachedSettings: TTSPayload | null;\n  isDirty: boolean;\n  currentlyPlayingAudio: HTMLAudioElement | null;\n  currentlyPlayingVoiceId: string | null;\n}\n\n/**\n * Context provided to the module\n */\nexport interface PreferencesContext {\n  apiBaseUrl: string;\n  testMode?: boolean;\n}\n\n/**\n * Services provided to the module\n */\nexport interface PreferencesServices {\n  getCurrentChannel: () => string;\n}\n\n/**\n * Optional dependencies\n */\nexport interface PreferencesDependencies {\n  onPreferencesLoaded?: (info: PreferencesInfo) => void;\n}\n\n/**\n * Return type of initPreferencesModule\n */\nexport interface PreferencesModule {\n  loadVoices: () => Promise<void>;\n  loadPreferences: () => Promise<PreferencesInfo>;\n  clearCachedAudio: () => void;\n  getCurrentPreferences: () => PreferencesData;\n}\n\n/**\n * Preference keys\n */\ntype PreferenceKey = 'voiceId' | 'pitch' | 'speed' | 'emotion' | 'language' | 'englishNormalization';\n\n/**\n * Preference value types\n */\ntype PreferenceValue = string | number | boolean | null;\n\nexport function initPreferencesModule(\n  context: PreferencesContext,\n  services: PreferencesServices,\n  deps: PreferencesDependencies = {}\n): PreferencesModule {\n  const { apiBaseUrl, testMode } = context;\n  const { getCurrentChannel } = services;\n  const { onPreferencesLoaded } = deps;\n\n  const elements: PreferencesElements = {\n    voiceSelect: document.getElementById('voice-select') as HTMLSelectElement | null,\n    voiceSearch: document.getElementById('voice-search') as HTMLInputElement | null,\n    voiceDropdown: document.getElementById('voice-dropdown'),\n    voiceMenu: document.getElementById('voice-menu'),\n    pitchSlider: document.getElementById('pitch-slider') as HTMLInputElement | null,\n    pitchValue: document.getElementById('pitch-value'),\n    speedSlider: document.getElementById('speed-slider') as HTMLInputElement | null,\n    speedValue: document.getElementById('speed-value'),\n    emotionSelect: document.getElementById('emotion-select') as HTMLSelectElement | null,\n    languageSelect: document.getElementById('language-select') as HTMLSelectElement | null,\n    voiceReset: document.getElementById('voice-reset') as HTMLButtonElement | null,\n    pitchReset: document.getElementById('pitch-reset') as HTMLButtonElement | null,\n    speedReset: document.getElementById('speed-reset') as HTMLButtonElement | null,\n    emotionReset: document.getElementById('emotion-reset') as HTMLButtonElement | null,\n    languageReset: document.getElementById('language-reset') as HTMLButtonElement | null,\n    englishNormalizationCheckbox: document.getElementById('english-normalization-checkbox') as HTMLInputElement | null,\n    englishNormalizationReset: document.getElementById('english-normalization-reset') as HTMLButtonElement | null,\n    hintVoice: document.getElementById('hint-voice'),\n    hintPitch: document.getElementById('hint-pitch'),\n    hintSpeed: document.getElementById('hint-speed'),\n    hintEmotion: document.getElementById('hint-emotion'),\n    hintLanguage: document.getElementById('hint-language'),\n    hintEnglishNorm: document.getElementById('hint-englishNormalization'),\n    previewText: document.getElementById('preview-text') as HTMLTextAreaElement | null,\n    previewBtn: document.getElementById('preview-btn') as HTMLButtonElement | null,\n    previewTextMobile: document.getElementById('preview-text-mobile') as HTMLTextAreaElement | null,\n    previewBtnMobile: document.getElementById('preview-btn-mobile') as HTMLButtonElement | null,\n    previewPlayer: document.getElementById('voice-preview-player'),\n    previewPlayerMobile: document.getElementById('voice-preview-player-mobile'),\n    previewSource: document.getElementById('voice-preview-source') as HTMLSourceElement | null,\n    previewSourceMobile: document.getElementById('voice-preview-source-mobile') as HTMLSourceElement | null,\n    previewHint: document.getElementById('voice-preview-hint'),\n    previewHintMobile: document.getElementById('voice-preview-hint-mobile'),\n    prefsDisabledNote: document.getElementById('prefs-disabled-note'),\n  };\n\n  const state: PreferencesState = {\n    availableVoices: [],\n    currentPreferences: {},\n    cachedAudioUrl: null,\n    cachedSettings: null,\n    isDirty: false,\n    currentlyPlayingAudio: null,\n    currentlyPlayingVoiceId: null,\n  };\n\n  syncTextareas(elements.previewText, elements.previewTextMobile);\n\n  attachSliderOutputs();\n  attachResetButtons();\n  attachPreferenceSaves();\n  attachPreviewHandlers();\n\n  function updatePreviewTextForLanguage(): void {\n    const selectedLanguage = languageSelect?.value || '';\n    const exampleText = getLanguageExample(selectedLanguage, 'viewer');\n\n    // Update both desktop and mobile preview text fields\n    if (elements.previewText) {\n      elements.previewText.value = exampleText;\n    }\n    if (elements.previewTextMobile) {\n      elements.previewTextMobile.value = exampleText;\n    }\n  }\n\n  return {\n    async loadVoices(): Promise<void> {\n      await loadVoices();\n    },\n    async loadPreferences(): Promise<PreferencesInfo> {\n      const info = await loadPreferences();\n      onPreferencesLoaded?.(info);\n      return info;\n    },\n    clearCachedAudio,\n    getCurrentPreferences: (): PreferencesData => state.currentPreferences,\n  };\n\n  function attachSliderOutputs(): void {\n    if (elements.pitchSlider && elements.pitchValue) {\n      elements.pitchSlider.addEventListener('input', () => {\n        if (elements.pitchSlider && elements.pitchValue) {\n          elements.pitchValue.textContent = elements.pitchSlider.value;\n        }\n      });\n    }\n    if (elements.speedSlider && elements.speedValue) {\n      elements.speedSlider.addEventListener('input', () => {\n        if (elements.speedSlider && elements.speedValue) {\n          elements.speedValue.textContent = Number(elements.speedSlider.value).toFixed(2);\n        }\n      });\n    }\n  }\n\n  function attachResetButtons(): void {\n    const { voiceReset, pitchReset, speedReset, emotionReset, languageReset, englishNormalizationReset, englishNormalizationCheckbox } = elements;\n    if (voiceReset) voiceReset.addEventListener('click', () => resetPreference('voiceId', elements.voiceSelect, ''));\n    if (pitchReset) pitchReset.addEventListener('click', () => resetPreference('pitch', elements.pitchSlider, 0));\n    if (speedReset) speedReset.addEventListener('click', () => resetPreference('speed', elements.speedSlider, 1));\n    if (emotionReset) emotionReset.addEventListener('click', () => resetPreference('emotion', elements.emotionSelect, ''));\n    if (languageReset) languageReset.addEventListener('click', () => resetPreference('language', elements.languageSelect, ''));\n    if (englishNormalizationReset && englishNormalizationCheckbox) {\n      englishNormalizationReset.addEventListener('click', () => resetPreference('englishNormalization', englishNormalizationCheckbox, false));\n    }\n  }\n\n  function attachPreferenceSaves(): void {\n    const {\n      voiceSelect,\n      pitchSlider,\n      speedSlider,\n      emotionSelect,\n      languageSelect,\n      englishNormalizationCheckbox,\n    } = elements;\n\n    if (voiceSelect) voiceSelect.addEventListener('change', () => savePreference('voiceId', voiceSelect.value || null));\n    if (pitchSlider) {\n      pitchSlider.addEventListener('change', () => {\n        const v = Number(pitchSlider.value);\n        savePreference('pitch', v);\n      });\n    }\n    if (speedSlider) {\n      speedSlider.addEventListener('change', () => {\n        const v = Number(speedSlider.value);\n        savePreference('speed', v);\n      });\n    }\n    if (emotionSelect) emotionSelect.addEventListener('change', () => savePreference('emotion', emotionSelect.value || null));\n    if (languageSelect) {\n      languageSelect.addEventListener('change', () => {\n        savePreference('language', languageSelect.value || null);\n        updatePreviewTextForLanguage();\n      });\n    }\n    if (englishNormalizationCheckbox) englishNormalizationCheckbox.addEventListener('change', () => {\n      savePreference('englishNormalization', englishNormalizationCheckbox.checked || false);\n    });\n  }\n\n  function attachPreviewHandlers(): void {\n    const { previewBtn, previewBtnMobile, previewText, previewTextMobile, voiceSelect, pitchSlider, speedSlider, emotionSelect, languageSelect, englishNormalizationCheckbox } = elements;\n\n    const changeElements = [voiceSelect, pitchSlider, speedSlider, emotionSelect, languageSelect, englishNormalizationCheckbox];\n    changeElements.forEach(el => {\n      if (el) el.addEventListener('change', markSettingsAsDirty);\n    });\n\n    if (previewBtn) previewBtn.addEventListener('click', () => testVoice());\n    if (previewBtnMobile) previewBtnMobile.addEventListener('click', () => testVoice());\n\n    window.addEventListener('beforeunload', () => {\n      if (state.cachedAudioUrl) URL.revokeObjectURL(state.cachedAudioUrl);\n    });\n\n    function markSettingsAsDirty(): void {\n      state.isDirty = true;\n      if (elements.previewHint && state.cachedAudioUrl) elements.previewHint.style.display = 'block';\n      if (elements.previewHintMobile && state.cachedAudioUrl) elements.previewHintMobile.style.display = 'block';\n    }\n\n    async function testVoice(): Promise<void> {\n      const text = (previewText?.value || previewTextMobile?.value || '').trim();\n      if (!text) {\n        showToast('Please enter some text to test', 'warning');\n        return;\n      }\n\n      if (testMode) {\n        showToast('Test validated \u2713 (test mode)', 'success');\n        return;\n      }\n\n      const pitchHasOverride = state.currentPreferences?.pitch !== undefined && state.currentPreferences?.pitch !== null;\n      const speedHasOverride = state.currentPreferences?.speed !== undefined && state.currentPreferences?.speed !== null;\n\n      const payload: TTSPayload = {\n        text,\n        voiceId: voiceSelect?.value || undefined,\n        pitch: pitchHasOverride ? Number(pitchSlider?.value ?? 0) : undefined,\n        speed: speedHasOverride ? Number(speedSlider?.value ?? 1) : undefined,\n        emotion: emotionSelect?.value || undefined,\n        languageBoost: languageSelect?.value || undefined,\n      };\n\n      const playerElements: PlayerElements = {\n        playerEl: elements.previewPlayer,\n        playerElMobile: elements.previewPlayerMobile,\n        sourceEl: elements.previewSource,\n        sourceElMobile: elements.previewSourceMobile,\n      };\n\n      const hintElements: HintElements = {\n        hintEl: elements.previewHint,\n        hintElMobile: elements.previewHintMobile,\n      };\n\n      const buttons = [previewBtn, previewBtnMobile].filter((btn): btn is HTMLButtonElement => btn !== null);\n\n      const onAudioGenerated = (audioUrl: string, settings: TTSPayload): void => {\n        if (state.cachedAudioUrl) URL.revokeObjectURL(state.cachedAudioUrl);\n        state.cachedAudioUrl = audioUrl;\n        state.cachedSettings = settings;\n        state.isDirty = false;\n        if (elements.previewHint) elements.previewHint.style.display = 'none';\n        if (elements.previewHintMobile) elements.previewHintMobile.style.display = 'none';\n      };\n\n      // Get the appropriate default text for the selected language\n      const selectedLanguage = languageSelect?.value || '';\n      const defaultText = getLanguageExample(selectedLanguage, 'viewer');\n\n      await performVoiceTest(payload, buttons, {\n        defaultText,\n        playerElements,\n        hintElements,\n        onAudioGenerated,\n      });\n    }\n  }\n\n  async function loadVoices(): Promise<void> {\n    const fallback = [\n      'Friendly_Person', 'Professional_Woman', 'Casual_Male', 'Energetic_Youth',\n      'Warm_Grandmother', 'Confident_Leader', 'Soothing_Narrator', 'Cheerful_Assistant',\n      'Deep_Narrator', 'Bright_Assistant', 'Calm_Guide', 'Energetic_Host'\n    ];\n\n    let voices = fallback;\n\n    if (!testMode) {\n      try {\n        const response = await fetch('https://chatvibes-tts-service-h7kj56ct4q-uc.a.run.app/api/voices');\n        if (response.ok) {\n          const data = await response.json() as { voices?: string[] };\n          voices = data.voices || fallback;\n        }\n      } catch (error) {\n        console.error('Failed to load voices, using fallback:', error);\n      }\n    }\n\n    state.availableVoices = voices;\n    setupVoiceDropdown(voices);\n  }\n\n  function setupVoiceDropdown(voices: string[]): void {\n    const { voiceSearch, voiceSelect, voiceMenu, voiceDropdown } = elements;\n    if (!voiceSearch || !voiceSelect || !voiceMenu || !voiceDropdown) return;\n\n    const list = voiceMenu.querySelector('.voice-dropdown-list');\n    if (!list) return;\n\n    voiceSelect.value = '';\n    voiceSearch.value = 'Use channel default';\n\n    renderVoiceList(voices);\n\n    voiceSearch.addEventListener('click', (e: MouseEvent) => {\n      e.stopPropagation();\n      const isOpen = voiceMenu.classList.contains('show');\n      if (isOpen) {\n        closeDropdown();\n      } else {\n        openDropdown();\n      }\n    });\n\n    voiceSearch.addEventListener('input', () => {\n      const query = voiceSearch.value.toLowerCase();\n      if (query === '' || query === 'use channel default') {\n        renderVoiceList(voices);\n        return;\n      }\n      const filtered = voices.filter(voice =>\n        formatVoiceName(voice).toLowerCase().includes(query)\n      );\n      renderVoiceList(filtered, false);\n    });\n\n    document.addEventListener('click', (e: MouseEvent) => {\n      if (!voiceDropdown.contains(e.target as Node)) {\n        closeDropdown();\n      }\n    });\n\n    function openDropdown(): void {\n      if (!voiceMenu || !voiceSearch) return;\n      voiceMenu.classList.add('show');\n      voiceSearch.removeAttribute('readonly');\n      voiceSearch.focus();\n      voiceSearch.select();\n    }\n\n    function closeDropdown(): void {\n      if (!voiceMenu || !voiceSearch || !voiceSelect) return;\n      voiceMenu.classList.remove('show');\n      voiceSearch.setAttribute('readonly', 'readonly');\n      const currentValue = voiceSelect.value;\n      voiceSearch.value = currentValue ? formatVoiceName(currentValue) : 'Use channel default';\n    }\n\n    function renderVoiceList(listVoices: string[], showDefault = true): void {\n      if (!list) return;\n      list.innerHTML = '';\n\n      if (showDefault) {\n        const defaultItem = document.createElement('div');\n        defaultItem.className = 'voice-dropdown-item';\n        const label = document.createElement('span');\n        label.className = 'voice-label';\n        label.textContent = 'Use channel default';\n        label.addEventListener('click', () => {\n          selectVoice('');\n        });\n        defaultItem.appendChild(label);\n        list.appendChild(defaultItem);\n      }\n\n      if (!listVoices.length) {\n        const empty = document.createElement('div');\n        empty.className = 'voice-dropdown-item no-results';\n        empty.textContent = 'No voices found';\n        list.appendChild(empty);\n        return;\n      }\n\n      listVoices.forEach(voiceId => {\n        const item = document.createElement('div');\n        item.className = 'voice-dropdown-item d-flex justify-content-between align-items-center';\n\n        const label = document.createElement('span');\n        label.className = 'voice-label';\n        label.textContent = formatVoiceName(voiceId);\n        label.addEventListener('click', () => selectVoice(voiceId));\n\n        const playBtn = document.createElement('button');\n        playBtn.type = 'button';\n        playBtn.className = 'voice-play-btn';\n        playBtn.setAttribute('aria-label', `Preview ${voiceId}`);\n        playBtn.innerHTML = `\n                    <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                        <path d=\"M8 5v14l11-7z\"/>\n                    </svg>\n                `;\n        playBtn.addEventListener('click', async (e: MouseEvent) => {\n          e.stopPropagation();\n          await playVoiceSample(voiceId, playBtn);\n        });\n\n        item.appendChild(label);\n        item.appendChild(playBtn);\n        list.appendChild(item);\n      });\n    }\n\n    function selectVoice(voiceId: string): void {\n      if (!voiceSelect || !voiceSearch || !voiceMenu) return;\n      voiceSelect.value = voiceId;\n      voiceSearch.value = voiceId ? formatVoiceName(voiceId) : 'Use channel default';\n      voiceMenu.classList.remove('show');\n      voiceSearch.setAttribute('readonly', 'readonly');\n      savePreference('voiceId', voiceId || null);\n    }\n  }\n\n  async function playVoiceSample(voiceId: string, button: HTMLButtonElement): Promise<void> {\n    if (!voiceId) return;\n\n    if (state.currentlyPlayingVoiceId === voiceId && state.currentlyPlayingAudio) {\n      state.currentlyPlayingAudio.pause();\n      state.currentlyPlayingAudio = null;\n      state.currentlyPlayingVoiceId = null;\n      updatePlayButton(button, false);\n      return;\n    }\n\n    if (state.currentlyPlayingAudio) {\n      state.currentlyPlayingAudio.pause();\n      const prevBtn = document.querySelector('.voice-play-btn.playing') as HTMLButtonElement | null;\n      if (prevBtn) updatePlayButton(prevBtn, false);\n    }\n\n    const preMadeUrl = `/assets/voices/${voiceId}-chat-is-this-real.mp3`;\n\n    try {\n      const response = await fetch(preMadeUrl);\n      if (!response.ok) {\n        showToast('No preview available for this voice yet', 'info');\n        return;\n      }\n      const blob = await response.blob();\n      const audioUrl = URL.createObjectURL(blob);\n      const audio = new Audio(audioUrl);\n      state.currentlyPlayingAudio = audio;\n      state.currentlyPlayingVoiceId = voiceId;\n      updatePlayButton(button, true);\n\n      const cleanup = (): void => {\n        URL.revokeObjectURL(audioUrl);\n        updatePlayButton(button, false);\n        state.currentlyPlayingAudio = null;\n        state.currentlyPlayingVoiceId = null;\n      };\n\n      audio.addEventListener('ended', cleanup, { once: true });\n      audio.addEventListener('error', cleanup, { once: true });\n\n      await audio.play();\n    } catch (error) {\n      console.error('Error playing voice preview:', error);\n      updatePlayButton(button, false);\n      state.currentlyPlayingAudio = null;\n      state.currentlyPlayingVoiceId = null;\n    }\n  }\n\n  function updatePlayButton(button: HTMLButtonElement | null, isPlaying: boolean): void {\n    if (!button) return;\n    if (isPlaying) {\n      button.classList.add('playing');\n      button.innerHTML = `\n                <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                    <path d=\"M6 4h4v16H6V4zm8 0h4v16h-4V4z\"/>\n                </svg>\n            `;\n    } else {\n      button.classList.remove('playing');\n      button.innerHTML = `\n                <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\n                    <path d=\"M8 5v14l11-7z\"/>\n                </svg>\n            `;\n    }\n  }\n\n  async function loadPreferences(): Promise<PreferencesInfo> {\n    const currentChannel = getCurrentChannel();\n\n    if (testMode) {\n      const demo: PreferencesData = {\n        voiceId: '',\n        pitch: null,\n        speed: null,\n        emotion: '',\n        language: '',\n        englishNormalization: false,\n        channelDefaults: {\n          voiceId: 'Friendly_Person',\n          pitch: 0,\n          speed: 1.0,\n          emotion: 'neutral',\n          language: 'auto',\n          englishNormalization: false,\n        },\n        channelPolicy: { allowViewerPreferences: true },\n        ignoreStatus: { tts: false, music: false },\n      };\n      applyPreferences(demo);\n      return {\n        allowViewerPreferences: true,\n        ignoreStatus: demo.ignoreStatus || {},\n        channelDefaults: demo.channelDefaults || {},\n      };\n    }\n\n    try {\n      const endpoint = currentChannel\n        ? `${apiBaseUrl}/api/viewer/preferences/${encodeURIComponent(currentChannel)}`\n        : `${apiBaseUrl}/api/viewer/preferences`;\n      const response = await fetchWithAuth(endpoint, { method: 'GET' });\n      const data = await response.json() as PreferencesData;\n      applyPreferences(data);\n      return {\n        allowViewerPreferences: data?.channelPolicy?.allowViewerPreferences !== false,\n        ignoreStatus: data?.ignoreStatus || {},\n        channelDefaults: data?.channelDefaults || {},\n      };\n    } catch (error) {\n      console.error('Failed to load preferences:', error);\n      showToast('Failed to load preferences', 'error');\n      throw error;\n    }\n  }\n\n  function applyPreferences(data: PreferencesData): void {\n    state.currentPreferences = data || {};\n    const prefs = state.currentPreferences;\n\n    const {\n      voiceSelect,\n      pitchSlider,\n      pitchValue,\n      speedSlider,\n      speedValue,\n      emotionSelect,\n      languageSelect,\n      englishNormalizationCheckbox,\n      voiceReset,\n      pitchReset,\n      speedReset,\n      emotionReset,\n      languageReset,\n      prefsDisabledNote,\n    } = elements;\n\n    if (voiceSelect) {\n      voiceSelect.value = prefs.voiceId || '';\n      if (elements.voiceSearch) {\n        elements.voiceSearch.value = voiceSelect.value ? formatVoiceName(voiceSelect.value) : 'Use channel default';\n      }\n    }\n    if (pitchSlider && pitchValue) {\n      pitchSlider.value = String(prefs.pitch ?? 0);\n      pitchValue.textContent = String(prefs.pitch ?? 0);\n    }\n    if (speedSlider && speedValue) {\n      const val = prefs.speed ?? 1.0;\n      speedSlider.value = String(val);\n      speedValue.textContent = Number(val).toFixed(2);\n    }\n    if (emotionSelect) emotionSelect.value = prefs.emotion || '';\n    if (languageSelect) {\n      languageSelect.value = prefs.language || '';\n      // Update preview text to match the loaded language\n      updatePreviewTextForLanguage();\n    }\n    if (englishNormalizationCheckbox) englishNormalizationCheckbox.checked = prefs.englishNormalization || false;\n\n    updateHints();\n\n    const allowViewerPrefs = prefs?.channelPolicy?.allowViewerPreferences !== false;\n    const inputs: (HTMLElement | null)[] = [\n      voiceSelect, pitchSlider, speedSlider, emotionSelect,\n      languageSelect, englishNormalizationCheckbox,\n      voiceReset, pitchReset, speedReset, emotionReset, languageReset,\n    ];\n    inputs.forEach(el => {\n      if (!el) return;\n      (el as HTMLInputElement | HTMLSelectElement | HTMLButtonElement).disabled = !allowViewerPrefs;\n    });\n    if (prefsDisabledNote) {\n      prefsDisabledNote.classList.toggle('d-none', allowViewerPrefs);\n    }\n  }\n\n  function updateHints(keys?: PreferenceKey[]): void {\n    const map: Record<PreferenceKey, HTMLElement | null> = {\n      voiceId: elements.hintVoice,\n      pitch: elements.hintPitch,\n      speed: elements.hintSpeed,\n      emotion: elements.hintEmotion,\n      language: elements.hintLanguage,\n      englishNormalization: elements.hintEnglishNorm,\n    };\n    const toUpdate = Array.isArray(keys) ? keys : (Object.keys(map) as PreferenceKey[]);\n    toUpdate.forEach(key => {\n      const el = map[key];\n      if (!el) return;\n      el.textContent = describePreferenceHint(key);\n      el.style.display = '';\n      void el.offsetHeight; // force reflow for immediate update\n    });\n  }\n\n  function describePreferenceHint(key: PreferenceKey): string {\n    const prefs = state.currentPreferences || {};\n    const cd = prefs.channelDefaults || {};\n    const userVal = prefs[key];\n    const defVal = cd[key];\n    const hasUser = userVal !== null && userVal !== undefined && userVal !== '';\n    const hasDef = defVal !== null && defVal !== undefined && defVal !== '';\n    if (hasUser) return `Using your global preference: ${formatValueForHint(key, userVal)}`;\n    if (hasDef) return `Using channel default: ${formatValueForHint(key, defVal)}`;\n    return 'Using system default';\n  }\n\n  function formatValueForHint(key: PreferenceKey, value: PreferenceValue): string {\n    if (value === '' || value === undefined || value === null) return String(value);\n    if (key === 'speed') return formatNumberCompact(Number(value));\n    return String(value);\n  }\n\n  async function savePreference(key: PreferenceKey, value: PreferenceValue): Promise<void> {\n    const previous = state.currentPreferences ? state.currentPreferences[key] : undefined;\n    if (state.currentPreferences) {\n      (state.currentPreferences as Record<string, PreferenceValue>)[key] = value;\n      updateHints([key]);\n    }\n    if (testMode) {\n      showToast('Preference updated (test mode)', 'success');\n      return;\n    }\n    try {\n      const currentChannel = getCurrentChannel();\n      const body = { [key]: value };\n      const url = currentChannel\n        ? `${apiBaseUrl}/api/viewer/preferences/${encodeURIComponent(currentChannel)}`\n        : `${apiBaseUrl}/api/viewer/preferences`;\n      await fetchWithAuth(url, { method: 'PUT', body: JSON.stringify(body) });\n      showToast('Preference updated', 'success');\n    } catch (error) {\n      if (state.currentPreferences) {\n        (state.currentPreferences as Record<string, PreferenceValue>)[key] = previous as PreferenceValue;\n        updateHints([key]);\n      }\n      console.error(`Failed to save ${key}:`, error);\n      const err = error as Error;\n      showToast(`Failed to save ${key}: ${err.message}`, 'error');\n    }\n  }\n\n  async function resetPreference(\n    key: PreferenceKey,\n    element: HTMLInputElement | HTMLSelectElement | null,\n    fallbackValue: PreferenceValue\n  ): Promise<void> {\n    const cd = (state.currentPreferences && state.currentPreferences.channelDefaults) ? state.currentPreferences.channelDefaults : {};\n    const defaultValue = (cd[key] !== undefined && cd[key] !== null) ? cd[key] : fallbackValue;\n    if (!element) return;\n    if (element instanceof HTMLInputElement && element.type === 'checkbox') {\n      element.checked = Boolean(defaultValue);\n    } else {\n      element.value = (defaultValue === undefined || defaultValue === null) ? '' : String(defaultValue);\n    }\n    if (element instanceof HTMLInputElement && element.type === 'range') {\n      const output = document.getElementById(element.id.replace('-slider', '-value'));\n      if (output) {\n        const outVal = element.id === 'speed-slider' ? Number(defaultValue ?? 1).toFixed(2) : String(defaultValue ?? 0);\n        output.textContent = outVal;\n      }\n    }\n    await savePreference(key, null);\n  }\n\n  function clearCachedAudio(): void {\n    if (state.cachedAudioUrl) {\n      URL.revokeObjectURL(state.cachedAudioUrl);\n      state.cachedAudioUrl = null;\n    }\n    state.cachedSettings = null;\n    if (elements.previewPlayer) elements.previewPlayer.style.display = 'none';\n    if (elements.previewPlayerMobile) elements.previewPlayerMobile.style.display = 'none';\n    if (elements.previewBtn) elements.previewBtn.textContent = 'Send Preview';\n    if (elements.previewBtnMobile) elements.previewBtnMobile.textContent = 'Send Preview';\n    state.isDirty = false;\n  }\n}\n"],
  "mappings": "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",
  "names": ["languageSelect"]
}
