{
  "version": 3,
  "sources": ["channel-context.ts"],
  "sourcesContent": ["import { showToast, openDialog, closeDialog } from '../common/ui.js';\n\n/**\n * Context configuration for the channel context module\n */\nexport interface ChannelContextConfig {\n    testMode?: boolean;\n}\n\n/**\n * Services provided to the channel context module\n */\nexport interface ChannelContextServices {\n    setCurrentChannel: (channelName: string | null) => void;\n    getCurrentChannel: () => string | null;\n}\n\n/**\n * Optional dependencies for the channel context module\n */\nexport interface ChannelContextDeps {\n    onChannelChange?: (channelName: string | null) => void;\n}\n\n/**\n * DOM elements used by the channel context module\n */\ninterface ChannelContextElements {\n    channelContextCard: HTMLElement | null;\n    addChannelContextCard: HTMLElement | null;\n    channelContextNameEl: HTMLElement | null;\n    channelHint: HTMLElement | null;\n    openChannelContextModalBtn: HTMLElement | null;\n    clearChannelContextBtn: HTMLElement | null;\n    channelInputModal: HTMLDialogElement | null;\n    channelInputModalText: HTMLInputElement | null;\n    channelInputConfirm: HTMLButtonElement | null;\n    channelInputCancel: HTMLButtonElement | null;\n    channelInputTitle: HTMLElement | null;\n    channelInputDesc: HTMLElement | null;\n}\n\n/**\n * Options for opening the channel prompt modal\n */\nexport interface OpenChannelPromptOptions {\n    title: string;\n    description: string;\n    confirmLabel: string;\n    confirmClass?: string;\n    onConfirm: (channelName: string) => void;\n}\n\n/**\n * Public API returned by the channel context module\n */\nexport interface ChannelContextAPI {\n    setChannelUI: (channelName: string) => void;\n    clearChannelUI: () => void;\n    openChannelPrompt: (options: OpenChannelPromptOptions) => void;\n}\n\n/**\n * Manages channel context selection and modal workflow.\n */\nexport function initChannelContextModule(\n    context: ChannelContextConfig,\n    services: ChannelContextServices,\n    deps: ChannelContextDeps = {}\n): ChannelContextAPI {\n    const { testMode } = context;\n    const { setCurrentChannel } = services;\n    const { onChannelChange } = deps;\n\n    const elements: ChannelContextElements = {\n        channelContextCard: document.getElementById('channel-context-card'),\n        addChannelContextCard: document.getElementById('add-channel-context-card'),\n        channelContextNameEl: document.getElementById('channel-context-name'),\n        channelHint: document.getElementById('channel-hint'),\n        openChannelContextModalBtn: document.getElementById('open-channel-context-modal-btn'),\n        clearChannelContextBtn: document.getElementById('clear-channel-context-btn'),\n        channelInputModal: document.getElementById('channel-input-modal') as HTMLDialogElement | null,\n        channelInputModalText: document.getElementById('channel-input-modal-text') as HTMLInputElement | null,\n        channelInputConfirm: document.getElementById('channel-input-confirm') as HTMLButtonElement | null,\n        channelInputCancel: document.getElementById('channel-input-cancel') as HTMLButtonElement | null,\n        channelInputTitle: document.getElementById('channel-input-title'),\n        channelInputDesc: document.getElementById('channel-input-desc'),\n    };\n\n    let confirmHandler: ((channelName: string) => void) | null = null;\n\n    const api: ChannelContextAPI = {\n        setChannelUI,\n        clearChannelUI,\n        openChannelPrompt,\n    };\n\n    attachBaseListeners();\n\n    return api;\n\n    function attachBaseListeners(): void {\n        if (elements.openChannelContextModalBtn) {\n            elements.openChannelContextModalBtn.addEventListener('click', () => {\n                openChannelPrompt({\n                    title: 'Load Channel Context',\n                    description: 'Enter the channel name to view its defaults and manage opt-outs:',\n                    confirmLabel: 'Load',\n                    confirmClass: 'btn-primary',\n                    onConfirm: (channelName: string) => {\n                        applyChannel(channelName);\n                        showToast(testMode ? 'Channel context loaded (test mode)' : 'Channel context loaded', 'success');\n                    },\n                });\n            });\n        }\n\n        if (elements.clearChannelContextBtn) {\n            elements.clearChannelContextBtn.addEventListener('click', () => {\n                applyChannel(null);\n                showToast(testMode ? 'Channel context cleared (test mode)' : 'Channel context cleared', 'success');\n            });\n        }\n\n        if (elements.channelInputConfirm) {\n            elements.channelInputConfirm.addEventListener('click', () => {\n                const channelName = (elements.channelInputModalText?.value || '').trim().toLowerCase();\n                if (!channelName) {\n                    showToast('Please enter a channel name', 'warning');\n                    return;\n                }\n                if (confirmHandler) {\n                    confirmHandler(channelName);\n                }\n                closeChannelModal();\n            });\n        }\n\n        if (elements.channelInputCancel) {\n            elements.channelInputCancel.addEventListener('click', () => {\n                closeChannelModal();\n            });\n        }\n    }\n\n    function applyChannel(channelName: string | null): void {\n        setCurrentChannel(channelName);\n        if (channelName) {\n            setChannelUI(channelName);\n        } else {\n            clearChannelUI();\n        }\n        onChannelChange?.(channelName);\n    }\n\n    function setChannelUI(channelName: string): void {\n        if (!channelName) {\n            clearChannelUI();\n            return;\n        }\n\n        if (elements.channelContextCard) elements.channelContextCard.classList.remove('d-none');\n        if (elements.addChannelContextCard) elements.addChannelContextCard.classList.add('d-none');\n        if (elements.channelContextNameEl) elements.channelContextNameEl.textContent = channelName;\n        if (elements.channelHint) {\n            elements.channelHint.textContent = testMode ? 'Channel found \u2713 (test mode)' : 'Channel found \u2713';\n            elements.channelHint.className = 'form-text text-success';\n        }\n    }\n\n    function clearChannelUI(): void {\n        if (elements.channelContextCard) elements.channelContextCard.classList.add('d-none');\n        if (elements.addChannelContextCard) elements.addChannelContextCard.classList.remove('d-none');\n        if (elements.channelContextNameEl) elements.channelContextNameEl.textContent = '';\n        if (elements.channelHint) {\n            elements.channelHint.textContent = 'Load a channel to view its defaults';\n            elements.channelHint.className = 'form-text';\n        }\n    }\n\n    /**\n     * Opens the channel prompt modal with optional custom messaging.\n     */\n    function openChannelPrompt({ title, description, confirmLabel, confirmClass = 'btn-primary', onConfirm }: OpenChannelPromptOptions): void {\n        if (!elements.channelInputModal) return;\n        confirmHandler = onConfirm || null;\n        if (elements.channelInputModalText) elements.channelInputModalText.value = '';\n        if (elements.channelInputTitle) elements.channelInputTitle.textContent = title;\n        if (elements.channelInputDesc) elements.channelInputDesc.textContent = description;\n        if (elements.channelInputConfirm) {\n            elements.channelInputConfirm.textContent = confirmLabel;\n            elements.channelInputConfirm.className = `btn ${confirmClass}`;\n        }\n        openDialog(elements.channelInputModal);\n    }\n\n    function closeChannelModal(): void {\n        if (elements.channelInputModal) closeDialog(elements.channelInputModal);\n        confirmHandler = null;\n    }\n}\n"],
  "mappings": "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",
  "names": []
}
